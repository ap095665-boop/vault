<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Core Test</title>
<style>
body{background:#000;color:#00ff88;font-family:monospace;text-align:center;padding:20px}
input,textarea{width:90%;padding:12px;margin:10px;background:#fff;color:#000;border:none;border-radius:8px}
button{padding:12px;background:#111;color:#00ff88;border:none;border-radius:10px}
</style>
</head>
<body>

<h2>Crypto Core Test</h2>

<input id="pin" placeholder="Enter PIN">
<textarea id="data" placeholder="Text to encrypt"></textarea>

<button onclick="encryptData()">Encrypt</button>
<button onclick="decryptData()">Decrypt</button>

<textarea id="result" placeholder="Output"></textarea>

<script>

const systemKey="vault-system-secret";

async function getKey(pin,salt){

 let enc=new TextEncoder();

 let baseKey=await crypto.subtle.importKey(
  "raw",
  enc.encode(pin+systemKey),
  "PBKDF2",
  false,
  ["deriveKey"]
 );

 return crypto.subtle.deriveKey(
  {
   name:"PBKDF2",
   salt:salt,
   iterations:100000,
   hash:"SHA-256"
  },
  baseKey,
  {name:"AES-GCM",length:256},
  false,
  ["encrypt","decrypt"]
 );
}

async function encryptData(){

 let pin=document.getElementById("pin").value;
 let text=document.getElementById("data").value;

 let enc=new TextEncoder();

 let salt=crypto.getRandomValues(new Uint8Array(16));
 let iv=crypto.getRandomValues(new Uint8Array(12));

 let key=await getKey(pin,salt);

 let encrypted=await crypto.subtle.encrypt(
  {name:"AES-GCM",iv:iv},
  key,
  enc.encode(text)
 );

 let result={
  salt:Array.from(salt),
  iv:Array.from(iv),
  data:Array.from(new Uint8Array(encrypted))
 };

 document.getElementById("result").value=JSON.stringify(result);
}

async function decryptData(){

 let pin=document.getElementById("pin").value;
 let obj=JSON.parse(document.getElementById("result").value);

 let salt=new Uint8Array(obj.salt);
 let iv=new Uint8Array(obj.iv);
 let data=new Uint8Array(obj.data);

 let key=await getKey(pin,salt);

 let decrypted=await crypto.subtle.decrypt(
  {name:"AES-GCM",iv:iv},
  key,
  data
 );

 let dec=new TextDecoder();
 document.getElementById("data").value=dec.decode(decrypted);
}

</script>

</body>
</html>
